!function(t){t.Paddler={}}(window),function(t){function e(t,e,n,r,i,s){this._id=t,this._username=e,this._firstName=n,this._lastName=r,this._email=i,this._profile=s}function n(t,e,n,r,i,s,o,a){this._picture=t,this._birthdate=e,this._gender=n,this._height=r,this._weight=i,this._country=s,this._language=o,this._units=a}e.prototype.getId=function(){return this._id},e.prototype.getUsername=function(){return this._username},e.prototype.getFirstName=function(){return this._firstName},e.prototype.getLastName=function(){return this._lastName},e.prototype.getFullName=function(){var t=this._firstName;return t?t&&this._lastName&&(t+=" "+this._lastName):t=this._lastName,t||this._username},e.prototype.getEmail=function(){return this._email},e.prototype.getProfile=function(){return this._profile},e.prototype.fromData=function(t){return t?(this._id=t.id,this._username=t.username,this._firstName=t.first_name,this._lastName=t.last_name,this._email=t.email,this._profile=(new n).fromData(t.profile),this):this},e.prototype.serialize=function(){return JSON.stringify({id:this._id,username:this._username,firstName:this._firstName,lastName:this._lastName,email:this._email,profile:this._profile?this._profile.toData():{}})},e.prototype.unserialize=function(t){return this.fromData(JSON.parse(t)),this},n.prototype.fromData=function(t){return t?(this._picture=t.picture_url||t.picture,this._birthdate=t.birthdate,this._gender=t.gender,this._height=t.height,this._weight=t.weight,this._country=t.country,this._language=t.language,this._units=t.units,this):this},n.prototype.toData=function(){return{picture:this._picture,birthdate:this._birthdate,gender:this._gender,height:this._height,weight:this._weight,country:this._country,language:this._language,units:this._units}},n.prototype.getPicture=function(){return this._picture},n.prototype.getBirthdate=function(){return this._birthdate},n.prototype.getGender=function(){return this._gender},n.prototype.getHeight=function(){return this._height},n.prototype.getWeight=function(){return this._weight},n.prototype.getCountry=function(){return this._country},n.prototype.getLanguage=function(){return this._language},n.prototype.getUnits=function(){return this._units},t.User=e}(Paddler),function(t,e){t.Session={_user:null,_accessToken:null,init:function(){var n=e.localStorage.getItem("accessToken"),r=e.localStorage.getItem("user");this._user=r?(new t.User).unserialize(r):null,this._accessToken=n?n:null},setUser:function(t){return this._user=t,e.localStorage.setItem("user",t?t.serialize():null),this},getUser:function(){return this._user},setAccessToken:function(t){return this._accessToken=t,e.localStorage.setItem("accessToken",t),this},getAccessToken:function(){return this._accessToken},destroy:function(){this.setUser(null),this.setAccessToken(null)}}}(Paddler,window),function(t,e){function n(t){return-1===t.indexOf("/",t.length-1)&&(t+="/"),a+t}function r(t){if("object"==typeof t)for(var e in t)if(t.hasOwnProperty(e)){var n,i=t[e];if("string"==typeof i&&(n=i.match(h))){var s=Date.parse(n[0]);isNaN(s)||(t[e]=new Date(s))}else"object"==typeof i&&r(i)}}function i(t){var e,n,r=new FormData;for(e in t)t.hasOwnProperty(e)&&(n=t[e],"object"==typeof n?s(r,e,n):r.append(e,n));return r}function s(t,e,n){var r,i;for(r in n)n.hasOwnProperty(r)&&(i=n[r],void 0!==i&&t.append(e+"."+r,i))}function o(s,o,a,u){var h=u||new c,f=e.Deferred(),p={Authorization:t.Session.getAccessToken()?"JWT "+t.Session.getAccessToken():void 0};return h.isFileUpload()&&(p["Content-Type"]=void 0,a=i(a)),e.ajax({type:s,url:n(o),data:a,headers:p}).done(function(t,e,n){r(t),f.resolve({status:n.status,statusText:n.statusText,data:t})}).fail(function(t){var e,n=JSON.parse(t.response);n&&n.error?e=n.error:n&&(e=n),f.reject({status:t.status,statusText:t.statusText,error:e})}),f.promise()}var a="http://strikedaemon.pythonanywhere.com/api",u=[],h=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,c=function(t){this._fileUpload=!!t};c.prototype.setFileUpload=function(t){this._fileUpload=!!t},c.prototype.isFileUpload=function(){return!!this._fileUpload},t.Remote={get:function(t,e,n){return e instanceof c&&(n=e,e=void 0),o("get",t,e,n)},post:function(t,e,n){return o("post",t,e,n)},put:function(t,e,n){return o("put",t,e,n)},"delete":function(t,e,n){return o("delete",t,e,n)},registerErrorHandler:function(t){u.push(t)},Options:c},t.Deferred=e.Deferred}(Paddler,Zepto),function(t,e){t.Authentication={isAuthenticated:function(){return null!==t.Session.getUser()},registration:function(e,n,r,i){return t.Remote.post("/auth/registration",{username:e,password1:n,password2:r,email:i})},login:function(e,n){return t.Remote.post("/auth/login",{username:e,password:n}).done(function(e){var n=e.data.token,r=(new t.User).fromData(e.data.user);return t.Session.setAccessToken(n),t.Session.setUser(r),r})},logout:function(){return t.Session.destroy(),t.Deferred().resolve(!0)},autoLogin:function(){return t.Session.init(),!this.isAuthenticated()&&e.localStorage.getItem("accessToken")?(t.Session.setAccessToken(e.localStorage.getItem("accessToken")),this.getUser()):void 0},getUser:function(){return t.Remote.get("/auth/user").then(function(e){var n=(new t.User).fromData(e.data);return t.Session.setUser(n),n})},userSave:function(e){return t.Remote.put("/auth/user",e,new t.Remote.Options(!0)).then(function(e){var n=(new t.User).fromData(e.data);return t.Session.setUser(n),n})},recoverPassword:function(e){return t.Remote.post("/auth/password/reset/",{email:e})},recoverPasswordConfirm:function(e,n,r,i){return t.Remote.post("/auth/password/reset/confirm",{uid:e,token:n,new_password1:r,new_password2:i})}}}(Paddler,window);