!function(t){t.Paddler={}}(window),function(t){function e(t,e,i,n,s,r){this._id=t,this._username=e,this._firstName=i,this._lastName=n,this._email=s,this._profile=r}function i(t,e,i,n,s,r,o,a){this._picture=t,this._birthdate=e,this._gender=i,this._height=n,this._weight=s,this._country=r,this._language=o,this._units=a}e.prototype.getId=function(){return this._id},e.prototype.getUsername=function(){return this._username},e.prototype.getFirstName=function(){return this._firstName},e.prototype.getLastName=function(){return this._lastName},e.prototype.getFullName=function(){var t=this._firstName;return t?t&&this._lastName&&(t+=" "+this._lastName):t=this._lastName,t||this._username},e.prototype.getEmail=function(){return this._email},e.prototype.getProfile=function(){return this._profile},e.prototype.fromData=function(t){return t?(this._id=t.id,this._username=t.username,this._firstName=t.first_name,this._lastName=t.last_name,this._email=t.email,this._profile=(new i).fromData(t.profile),this):this},e.prototype.serialize=function(){return JSON.stringify({id:this._id,username:this._username,firstName:this._firstName,lastName:this._lastName,email:this._email,profile:this._profile?this._profile.toData():{}})},e.prototype.unserialize=function(t){return this.fromData(JSON.parse(t)),this},i.prototype.fromData=function(t){return t?(this._picture=t.picture_url||t.picture,this._birthdate=t.birthdate,this._gender=t.gender,this._height=t.height,this._weight=t.weight,this._country=t.country,this._language=t.language,this._units=t.units,this):this},i.prototype.toData=function(){return{picture:this._picture,birthdate:this._birthdate,gender:this._gender,height:this._height,weight:this._weight,country:this._country,language:this._language,units:this._units}},i.prototype.getPicture=function(){return this._picture},i.prototype.getBirthdate=function(){return this._birthdate},i.prototype.getGender=function(){return this._gender},i.prototype.getHeight=function(){return this._height},i.prototype.getWeight=function(){return this._weight},i.prototype.getCountry=function(){return this._country},i.prototype.getLanguage=function(){return this._language},i.prototype.getUnits=function(){return this._units},t.User=e}(Paddler),function(t){function e(t,e,i,n,s,r,o,a,u,p){this._id=t,this._description=e,this._date=i,this._duration=n,this._distance=s,this._avgSpeed=r,this._maxSpeed=o,this._avgSpm=a,this._maxSpm=u,this._data=p}function i(t,e,i,n,s){this._timestamp=t,this._distance=e,this._speed=i,this._spm=n,this._spmEfficiency=s}e.prototype.getId=function(){return this._id},e.prototype.setId=function(t){this._id=t},e.prototype.getDescription=function(){return this._description},e.prototype.setDescription=function(t){this._description=t},e.prototype.getDate=function(){return this._date},e.prototype.setDate=function(t){this._date=t},e.prototype.getDuration=function(){return this._duration},e.prototype.setDuration=function(t){this._duration=t},e.prototype.getDistance=function(){return this._distance},e.prototype.setDistance=function(t){this._distance=t},e.prototype.getAvgSpeed=function(){return this._avgSpeed},e.prototype.setAvgSpeed=function(t){this._avgSpeed=t},e.prototype.getMaxSpeed=function(){return this._maxSpeed},e.prototype.setMaxSpeed=function(t){this._maxSpeed=t},e.prototype.getAvgSpm=function(){return this._avgSpm},e.prototype.setAvgSpm=function(t){this._avgSpm=t},e.prototype.getMaxSpm=function(){return this._maxSpm},e.prototype.setMaxSpm=function(t){this._maxSpm=t},e.prototype.getData=function(){return this._data},e.prototype.setData=function(t){this._data=t},e.prototype.fromData=function(t){if(!t)return this;var e,n;if(this._id=t.id,this._description=t.description,this._date=t.date,this._duration=t.duration,this._distance=t.distance,this._avgSpeed=t.avg_speed,this._maxSpeed=t.max_speed,this._avgSpm=t.avg_spm,this._maxSpm=t.max_spm,this._data=[],t.training_session_data&&t.training_session_data.length)for(e=0,n=t.training_session_data.length;n>e;e++)this._data.push((new i).fromData(t.training_session_data[e]));return this},e.prototype.toData=function(){var t,e,i=[];if(this._data&&this._data.length)for(t=0,e=this._data.length;e>t;t++)i.push(this._data[t].toData());return{id:this._id,description:this._description,date:this._date,duration:this._duration,distance:this._distance,avg_speed:this._avgSpeed,max_speed:this._maxSpeed,avg_spm:this._avgSpm,max_spm:this._maxSpm,data:i}},i.prototype.getTimestamp=function(){return this._timestamp},i.prototype.setTimestamp=function(t){this._timestamp=t},i.prototype.getDistance=function(){return this._distance},i.prototype.setDistance=function(t){this._distance=t},i.prototype.getSpeed=function(){return this._speed},i.prototype.setSpeed=function(t){this._speed=t},i.prototype.getSpm=function(){return this._spm},i.prototype.setSpm=function(t){this._spm=t},i.prototype.getSpmEfficiency=function(){return this._spmEfficiency},i.prototype.setSpmEfficiency=function(t){this._spmEfficiency=t},i.prototype.fromData=function(t){return t?(this._timestamp=t.timestamp,this._distance=t.distance,this._speed=t.speed,this._spm=t.spm,this._spmEfficiency=t.spm_efficiency,this):this},i.prototype.toData=function(){return{timestamp:this._timestamp,distance:this._distance,speed:this._speed,spm:this._spm,spm_efficiency:this._spmEfficiency}},t.TrainingSession=e,t.TrainingSessionData=i}(Paddler),function(t,e){t.Session={_user:null,_accessToken:null,init:function(){var i=e.localStorage.getItem("accessToken"),n=e.localStorage.getItem("user");this._user=n?(new t.User).unserialize(n):null,this._accessToken=i?i:null},setUser:function(t){return this._user=t,e.localStorage.setItem("user",t?t.serialize():null),this},getUser:function(){return this._user},setAccessToken:function(t){return this._accessToken=t,e.localStorage.setItem("accessToken",t),this},getAccessToken:function(){return this._accessToken},destroy:function(){this.setUser(null),this.setAccessToken(null)}}}(Paddler,window),function(t,e){function i(t){return-1===t.indexOf("/",t.length-1)&&(t+="/"),a+t}function n(t){if("object"==typeof t)for(var e in t)if(t.hasOwnProperty(e)){var i,s=t[e];if("string"==typeof s&&(i=s.match(p))){var r=Date.parse(i[0]);isNaN(r)||(t[e]=new Date(r))}else"object"==typeof s&&n(s)}}function s(t){var e,i,n=new FormData;for(e in t)t.hasOwnProperty(e)&&(i=t[e],"object"==typeof i?r(n,e,i):n.append(e,i));return n}function r(t,e,i){var n,s;for(n in i)i.hasOwnProperty(n)&&(s=i[n],void 0!==s&&t.append(e+"."+n,s))}function o(r,o,a,u){var p=u||new c,h=e.Deferred(),d={Authorization:t.Session.getAccessToken()?"JWT "+t.Session.getAccessToken():void 0};return p.isFileUpload()&&(d["Content-Type"]=void 0,a=s(a)),e.ajax({type:r,url:i(o),data:a,headers:d}).done(function(t,e,i){n(t),h.resolve({status:i.status,statusText:i.statusText,data:t})}).fail(function(t){var e,i=JSON.parse(t.response);i&&i.error?e=i.error:i&&(e=i),h.reject({status:t.status,statusText:t.statusText,error:e})}),h.promise()}var a="http://strikedaemon.pythonanywhere.com/api",u=[],p=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,c=function(t){this._fileUpload=!!t};c.prototype.setFileUpload=function(t){this._fileUpload=!!t},c.prototype.isFileUpload=function(){return!!this._fileUpload},t.Remote={get:function(t,e,i){return e instanceof c&&(i=e,e=void 0),o("get",t,e,i)},post:function(t,e,i){return o("post",t,e,i)},put:function(t,e,i){return o("put",t,e,i)},"delete":function(t,e,i){return o("delete",t,e,i)},registerErrorHandler:function(t){u.push(t)},Options:c},t.Deferred=e.Deferred}(Paddler,Zepto),function(t,e){t.Authentication={isAuthenticated:function(){return null!==t.Session.getUser()},registration:function(e,i,n,s){return t.Remote.post("/auth/registration",{username:e,password1:i,password2:n,email:s})},login:function(e,i){return t.Remote.post("/auth/login",{username:e,password:i}).done(function(e){var i=e.data.token,n=(new t.User).fromData(e.data.user);return t.Session.setAccessToken(i),t.Session.setUser(n),n})},logout:function(){return t.Session.destroy(),t.Deferred().resolve(!0)},autoLogin:function(){return t.Session.init(),!this.isAuthenticated()&&e.localStorage.getItem("accessToken")?(t.Session.setAccessToken(e.localStorage.getItem("accessToken")),this.getUser()):void 0},getUser:function(){return t.Remote.get("/auth/user").then(function(e){var i=(new t.User).fromData(e.data);return t.Session.setUser(i),i})},userSave:function(e){return t.Remote.put("/auth/user",e,new t.Remote.Options(!0)).then(function(e){var i=(new t.User).fromData(e.data);return t.Session.setUser(i),i})},recoverPassword:function(e){return t.Remote.post("/auth/password/reset/",{email:e})},recoverPasswordConfirm:function(e,i,n,s){return t.Remote.post("/auth/password/reset/confirm",{uid:e,token:i,new_password1:n,new_password2:s})}}}(Paddler,window),function(t,e){function i(t){var e,i,s=[];if(t&&t.length)for(e=0,i=t.length;i>e;e++)s.push(n(t[e]));return s}function n(e){return e?(new t.TrainingSession).fromData(e):null}t.TrainingSessions={getAll:function(){var n=e.Deferred();return t.Remote.get("/training-sessions").done(function(t){n.resolve(i(t.data))}).fail(function(t){n.reject(t)}),n.promise()},getAllByMonth:function(n,s){var r=e.Deferred();return t.Remote.get("/training-sessions/"+n+"/"+s+"/").done(function(t){r.resolve(i(t.data))}).fail(function(t){r.reject(t)}),r.promise()},get:function(i){var s=e.Deferred();return t.Remote.get("/training-sessions/"+i).done(function(t){s.resolve(n(t.data))}).fail(function(t){s.reject(t)}),s.promise()},save:function(i){var s,r=e.Deferred();return s=i.getId()?t.Remote.put("/training-sessions/"+i.getId(),i.toData()):t.Remote.post("/training-sessions",i.toData()),s.done(function(t){r.resolve(n(t.data))}).fail(function(t){r.reject(t)}),r.promise()},"delete":function(e){return t.Remote["delete"]("/training-sessions/"+e)}}}(Paddler,Zepto);